using System.Collections;
using UnityEngine;

[RequireComponent(typeof(AudioSource))]
public class Door : MonoBehaviour
{
    public bool open;
    public float duration = 1.0f; // KapÄ±nÄ±n aÃ§Ä±lma sÃ¼resi

    float DoorCloseAngle = 0.0f;

    [Header("AÃ§Ä±lÄ±ÅŸ yÃ¶nÃ¼ ayarÄ±")]
    public bool invertDirection; // true ise +90'a doÄŸru aÃ§Ä±lÄ±r
    float DoorOpenAngle => invertDirection ? 90.0f : -90.0f;

    public AudioSource asource;
    public AudioClip openDoor, closeDoor;

    private Coroutine doorCoroutine;

    // ðŸ”¹ KapÄ± aÃ§Ä±ldÄ±ÄŸÄ±nda herkesin dinleyebileceÄŸi event
    public static System.Action<Door> OnAnyDoorOpened;

    void Start()
    {
        asource = GetComponent<AudioSource>();
    }

    public void OpenDoor()
    {
        open = !open;

        // Ses Ã§al
        if (asource != null)
        {
            asource.clip = open ? openDoor : closeDoor;
            asource.Play();
        }

        // Ã–nceki animasyonu durdur
        if (doorCoroutine != null)
            StopCoroutine(doorCoroutine);

        // Yeni animasyonu baÅŸlat
        float targetAngle = open ? DoorOpenAngle : DoorCloseAngle;
        doorCoroutine = StartCoroutine(RotateDoor(targetAngle));

        // ðŸ”¹ KapÄ± aÃ§Ä±ldÄ±ysa event gÃ¶nder (Update gerekmez)
        if (open)
            OnAnyDoorOpened?.Invoke(this);
    }

    private IEnumerator RotateDoor(float targetAngle)
    {
        float startAngle = transform.localEulerAngles.y;
        float angleDiff = Mathf.DeltaAngle(startAngle, targetAngle);
        float elapsed = 0f;

        while (elapsed < duration)
        {
            float currentAngle = startAngle + (angleDiff * (elapsed / duration));
            transform.localRotation = Quaternion.Euler(0, currentAngle, 0);
            elapsed += Time.deltaTime;
            yield return null;
        }

        transform.localRotation = Quaternion.Euler(0, targetAngle, 0);
    }
}
